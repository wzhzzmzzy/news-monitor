# TrendAnalyzor PRD：动态时间窗口与历史趋势分析

## 1. 背景与目标 (Background & Goals)

### 1.1 现状与痛点
当前的 TrendAnalyzor 报告主要基于“自然日”维度。虽然引入了 7 天的历史背景参考，但在实际使用中存在以下局限：
- **无法跨时段聚合**：例如“昨天下午到今天上午”的突发事件会被切割在两份报告中。
- **缺乏深度演变**：历史数据仅作为热度权重的参考，未能直观展示话题在时间轴上的演变路径。
- **配置不够灵活**：用户无法通过简单的命令行参数获取特定时间段（如“过去 24 小时”）的定制化报告。

### 1.2 核心目标
本功能旨在引入 **“动态时间窗口”** 机制，通过 `start` 和 `end` 参数赋予用户任意调度数据的能力，并根据窗口跨度自动在“单日细节分析”与“历史趋势深度分析”两种模式间切换。

## 2. 核心概念：动态时间窗口 (Dynamic Time Window)

系统核心逻辑由“固定日期”转向“动态闭区间 `[start, end]`”。

### 2.1 参数标准
- **参数名称**: `--start`, `--end`
- **强制格式**: `yy-mm-dd hh:MM` (例如：`26-02-11 08:30`)
- **默认行为**: 若不指定参数，默认 `start = 当天 01:00`, `end = 当前时刻`。

### 2.2 模式自动判定逻辑
系统根据时间窗口的跨度自动调整分析深度与报告模板：

- **单日模式 (Single-Day Mode)**:
  - **判定条件**: `start` 与 `end` 处于当地时间的同一天。
  - **定位**: 还原细节。侧重于当日具体新闻条目、即时热度和多源链接。
- **历史趋势模式 (Historical Trend Mode)**:
  - **判定条件**: `start` 与 `end` 跨越了至少一个日期（非同一天）。
  - **定位**: 洞察演变。侧重于话题在时间轴上的里程碑、历史回顾及跨周期的深度总结。

## 3. 功能详细描述 (Functional Descriptions)

### 3.1 跨日期数据聚合 (Cross-Date Aggregation)
系统必须具备跨越多个 `archive/YYYY-MM-DD/` 目录检索并过滤数据的能力。
- 检索所有在 `[start, end]` 时间范围内的 `HourlyBatchResult`。
- 保证分析素材的连续性，不再受自然日零点切割的影响。

### 3.2 历史趋势增强分析 (Enhanced Historical Analysis)
在判定为“历史趋势模式”时，报告内容需包含以下增强板块：

- **趋势演变分析 (Evolution Insight)**：
  - 要求 LLM 对比该话题在区间内不同日期的表现。
  - 总结该话题的“起源 -> 爆发 -> 现状/反转”过程。
- **多点历史回顾 (Timeline Retrospective)**：
  - 在每个核心话题下，除了展示当前最热新闻，还需展示该话题在区间内其他关键时刻的代表性新闻标题。
  - 使用时间轴形式排列，直观展示报道焦点的转移。

### 3.3 统一报告模板 (Unified Adaptive Template)
报告模板需具备自适应能力：
- 顶部清晰标注报告的实际时间跨度。
- 根据模式自动切换展示组件：单日模式展示“新闻明细表”，历史模式展示“趋势演化图”与“里程碑”。

## 4. 业务逻辑流程 (Business Logic Flow)

1. **输入解析**: 接收并验证 `start` / `end` 参数格式。
2. **数据搜寻**: 扫描相关日期的存档文件。
3. **数据清洗**: 剔除超出 `[start, end]` 范围的批次。
4. **模式判定**: 检查是否跨天。
5. **AI 深度分析**: 
   - 传入跨日期的聚合数据。
   - 根据模式注入不同的 Prompt 指令。
6. **渲染与分发**: 生成自适应 HTML 报告并通过邮件发送。

## 5. 用户交互示例 (User Interaction)

### 5.1 手动生成过去 24 小时报告
```bash
pnpm dev report --start "26-02-10 10:00" --end "26-02-11 10:00"
```
*系统判定为“历史趋势模式”，报告将包含对这两天新闻演变的对比分析。*

### 5.2 默认生成今日早报
```bash
pnpm dev report
```
*（假设当前是 02-11 09:00）系统默认分析 02-11 01:00 至 09:00。*
*系统判定为“单日模式”，报告侧重于今日凌晨到现在的突发细节。*

## 6. 成功指标 (Success Metrics)
- 报告生成的准确率：跨日期数据的召回率达到 100%。
- 用户体验：参数错误时能给出清晰的格式引导。
- AI 质量：在历史模式下，LLM 能准确识别出话题在不同天数间的逻辑关联。
